#########################################################################################
## VASProcar -- https://github.com/Augusto-Dlelis/VASProcar-Tools-Python ################
## Autores: #############################################################################
## =================================================================================== ##
## Augusto de Lelis Araujo - Federal University of Uberlandia (Uberlândia/MG - Brazil) ##
## e-mail: augusto-lelis@outlook.com                                                   ##
## =================================================================================== ##
## Renan da Paixão Maciel - Uppsala University (Uppsala/Sweden) #########################
## e-mail: renan.maciel@physics.uu.se                           #########################
#########################################################################################

#--------------------------------------------------------------------
# Verificando se a pasta "Plot_4D" existe, se não existe ela é criada
#--------------------------------------------------------------------
if os.path.isdir("saida/Plot_4D"):
   0 == 0
else:
   os.mkdir("saida/Plot_4D")
#---------------------------

#======================================================================
# Extraindo informações dos arquivos OUTCAR e CONTCAR =================
#======================================================================

#-----------------------------------------
executavel = Diretorio + '/informacoes.py'
exec(open(executavel).read())
#-----------------------------------------

#======================================================================
# Obtenção dos parâmetros de input ====================================
#======================================================================

print ("##############################################################")
print ("################## Plot 4D (ISOSUPERFICIE): ##################")
print ("##############################################################")
print (" ")

if (escolha == -7):

   print ("##############################################################") 
   print ("## Escolha a dimensao dos eixos-k no Plot: ================ ##")
   print ("##############################################################")
   print ("## [1] (kx,ky,kz) em unidades de 2pi/Param. =============== ##")
   print ("## [2] (kx,ky,kz) em unidades de 1/Angs. ================== ##")
   print ("## [3] (kx,ky,kz) em unidades de 1/nm. ==================== ##")
   print ("## [4] (k1,k2,k3) Coord. Diretas: K = k1*B1 + k2*B2 + k3*B3 ##")   
   print ("##############################################################") 
   Dimensao = input (" "); Dimensao = int(Dimensao)
   print (" ")

   print ("##############################################################")
   print ("Quantas isosuperficies deseja obter no Plot: =================")
   print ("Dica: Utilize 15 (Quanto maior mais preciso e pesado) ========")
   print ("##############################################################") 
   n_iso = input (" "); n_iso = int(n_iso)
   print (" ")

   print ("##############################################################")
   print ("Qual a dimensao-D (DxDxD) do GRID de interpolacao? ===========")
   print ("Dica: Utilize 31 (Quanto maior mais preciso e pesado) ========")
   print ("##############################################################") 
   n_d = input (" "); n_d = int(n_d)
   print (" ")   

if (escolha == 7):
   Dimensao = 1
   n_iso = 15
   n_d = 31

print ("##############################################################")
print ("O que deseja analisar? =======================================")
print ("[1] Dispersao de energia 3D de uma dada banda ================")
print ("[2] Magnitude de separacao entre 2 bandas ====================")
print ("##############################################################") 
esc = input (" "); esc = int(esc)
print (" ")

if (esc == 1):
   print ("Escolha a Banda a ser analisada: =============================")
   Band = input (" "); Band = int(Band)
   print (" ")
   Band_1 = 0; Band_2 = 0

if (esc == 2):
   print ("Informe a 1 Banda: ===========================================")
   Band_1 = input (" "); Band_1 = int(Band_1)
   print ("Informe a 2 Banda: ===========================================")
   Band_2 = input (" "); Band_2 = int(Band_2)     
   print (" ")
   Band = 0

#----------------------------------------------------------------------
# Extraindo os resultados do(s) arquivo(s) PROCAR ---------------------
#----------------------------------------------------------------------

#------------------------------------
executavel = Diretorio + '/procar.py'
exec(open(executavel).read())
#------------------------------------

#======================================================================
#======================================================================
# Obtendo dados para o Plot 4D ========================================
#======================================================================
#======================================================================

#------------------------------------------------
plot4D = open("saida/Plot_4D/plot_4d.dat", "w")
#------------------------------------------------

for i in range (1,(n_procar+1)):
    for j in range (1,(nk+1)):
        if (Dimensao < 4):
           x = kx[i][j]
           y = ky[i][j]
           z = kz[i][j]          
        if (Dimensao == 4):
           x = kb1[i][j]
           y = kb2[i][j]
           z = kb3[i][j]
        if (esc == 1):    
           e = Energia[i][j][Band]
        if (esc == 2):    
           e = (Energia[i][j][Band_2] - Energia[i][j][Band_1])
           e = (e**2)**0.5 
        plot4D .write(f'{x} {y} {z} {e} \n')

#-----------
plot4D .close()
#-----------

#---------------------------------------------------
executavel = Diretorio + '/plot_bandas_4D_plotly.py'
exec(open(executavel).read())
#---------------------------------------------------
   
#######################################################################
#######################################################################
#######
####### FIM DO CÓDIGO #################################################
#######
#######################################################################
#######################################################################
